<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="Scripts/jquery-3.5.1.js"></script>
    <script>
        function validate() {
            var inputvalue = $('input[type="text"]').filter(function (n) {
                return this.value.length > 0;
            })

            // var passw = document.getElementById('lozinka');


            if (inputvalue.length == $('input[type="text"]').length) {
                // if (passw.value.length != 0)
                $("input[type=submit]").prop("disabled", false);

            } else {
                $("input[type=submit]").prop("disabled", true);
            }
        }

        $('[type="submit"]').on('click', function () {
            // this adds 'required' class to all the required inputs under the same <form> as the submit button
            $(this)
                .find('[required]')
                .addClass('required');
        });
        $(document).ready(function () {
            let user = sessionStorage.getItem("logovan");
            var korisnik = $.parseJSON(user);
            console.log('user ' + korisnik.Ime);
            if (user == null) {
                alert("nije prij");
                $('#podaci').hide();
                $('#karte').hide();
                $('#korisnikKarte').hide();     //prikaz karata za kupce
            } else {
                if (korisnik.Uloga == 0) {//admin

                    $('#korisnikKarte').hide();

                } else if (korisnik.Uloga == 1) {
                    //prodavac

                    $('#korisnikKarte').hide();

                }
                else if (korisnik.Uloga == 2)
                {//kupac
                    $('#karte').show();
                    $('#korisnikKarte').show();
                    //-------------------------------------------prikaz svih rez karata
                    var obj2 = JSON.stringify({
                        "korisnik": korisnik.Korisnickoime
                    });
                    $.ajax({
                        type: 'POST',
                        url: '/api/Karte/SveKarte',
                        data: obj2,
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        success: function (data) {

                            //alert(data);
                            var jsonObj = JSON.parse(data);
                            for (i = 0; i < jsonObj.length; i++) {
                                var lista = "<tr>"
                                lista += "<td>" + jsonObj[i].Nazivmanifestacije + "</td>";
                                lista += "<td>" + jsonObj[i].Datummanifestacije + "</td>";
                                lista += " <td>" + jsonObj[i].Cena + "</td>";

                                if (jsonObj[i].Tipkarte == 0)//vip
                                {
                                    lista += "<td>" + " VIP " + "</td>";
                                } else if (jsonObj[i].Tipkarte == 1) {//regular
                                    lista += "<td>" + " REGULAR " + "</td>";
                                } else {
                                    lista += "<td>" + " FAN PIT " + "</td>";
                                }

                                if (jsonObj[i].Status == 0) {
                                    lista += "<td> Rezervisana </td>";
                                    var manifestacija = jsonObj[i].Nazivmanifestacije + ";" + jsonObj[i].Datummanifestacije;
                                    lista += "<td>" + "<button type = \"button\" id=\"" + manifestacija + "\" class=\"use-address\">Komentarisi</button>" + "</td>";
                                } else {
                                    if (jsonObj[i].MogucOdustanak == 1) {   //moguce je odustati
                                        lista += "<td> Odustanak </td>";
                                        lista += "<td>" + "<button type = \"button\" id=\"" + jsonObj[i].Idkarte + "\" class=\"odustani\">Odustani</button>" + "</td>";
                                    }
                                }

                                lista += "</tr>";
                                $("#tabelaKarte").append(lista);
                                //lista += "</td>"
                            }

                            //        document.getElementById('lista').innerHTML = lista;

                        },
                        error: function (data) {
                            alert("Greska!");
                        }
                    });

                    $("#pretraga").click(function () {

                        let dat1 = document.getElementById('find_datumOD');
                        let dat2 = document.getElementById('find_datumDO');
                        let k1 = document.getElementById('find_naziv');



                        if (!dat1.checkValidity() || !dat2.checkValidity()) {
                            alert("Unesite datum u naznacenom formatu dd-mm-yyyy");
                        }
                        else if (!k1.checkValidity()) {
                            alert("Mozete uneti samo slova i cifre prilikom pretrage po nazivu");//,bez suvisnih razmaka na pocetku i kraju");
                        }
                        else {
                            var tabelica = document.getElementById('tabelaKarte');
                            for (var i = 1; i < tabelica.rows.length;) {
                                tabelica.deleteRow(i);
                            }

                            var naziv = $("#find_naziv").val();
                            var datumOD = $("#find_datumOD").val();
                            var datumDO = $("#find_datumDO").val();
                            var cenaOD = $("#find_cenaOD").val();
                            var cenaDO = $("#find_cenaDO").val();
                            var obj2 = JSON.stringify({
                                "korisnik": korisnik.Korisnickoime,
                                "naziv": naziv,
                                "datumOD": datumOD,
                                "datumDO": datumDO,
                                "cenaOD": cenaOD.toString(),
                                "cenaDO": cenaDO.toString()
                            });



                            //var obj2 = JSON.stringify({
                            //    "korisnik": korisnik.Korisnickoime
                            //});

                            $.ajax({
                                type: 'POST',
                                url: '/api/Karte/KupacPretraga',
                                data: obj2,
                                contentType: 'application/json; charset=utf-8',
                                dataType: 'json',
                                success: function (data) {

                                    // alert(data);
                                    var jsonObj = JSON.parse(data);
                                    for (i = 0; i < jsonObj.length; i++) {
                                        var lista = "<tr>"
                                        lista += "<td>" + jsonObj[i].Nazivmanifestacije + "</td>";
                                        lista += "<td>" + jsonObj[i].Datummanifestacije + "</td>";
                                        lista += " <td>" + jsonObj[i].Cena + "</td>";

                                        if (jsonObj[i].Tipkarte == 0)//vip
                                        {
                                            lista += "<td>" + " VIP " + "</td>";
                                        } else if (jsonObj[i].Tipkarte == 1) {//regular
                                            lista += "<td>" + " REGULAR " + "</td>";
                                        } else {
                                            lista += "<td>" + " FAN PIT " + "</td>";
                                        }

                                        if (jsonObj[i].Status == 0) {
                                            lista += "<td> Rezervisana </td>";
                                            var manifestacija = jsonObj[i].Nazivmanifestacije + ";" + jsonObj[i].Datummanifestacije;
                                            lista += "<td>" + "<button type = \"button\" id=\"" + manifestacija + "\" class=\"use-address\">Komentarisi</button>" + "</td>";
                                        } else {
                                            if (jsonObj[i].MogucOdustanak == 1) {   //moguce je odustati
                                                lista += "<td> Odustanak </td>";
                                                lista += "<td>" + "<button type = \"button\" id=\"" + jsonObj[i].Idkarte + "\" class=\"odustani\">Odustani</button>" + "</td>";
                                            }
                                        }

                                        lista += "</tr>";
                                        $("#tabelaKarte").append(lista);
                                        //lista += "</td>"
                                    }

                                    //        document.getElementById('lista').innerHTML = lista;

                                },
                                error: function (data) {
                                    alert("Greska!");
                                }
                            });
                        }
                    });
                    //------------------------------------------

                    $("#datumK").click(function () {
                        //var karte = $("#k_tip option:selected").val();
                        //alert("od" + karte);
                        var obj2 = JSON.stringify({
                            "korisnik": korisnik.Korisnickoime
                        });

                        var tabelica = document.getElementById('tabelaKarte');
                        for (var i = 1; i < tabelica.rows.length;) {
                            tabelica.deleteRow(i);
                        }

                        $.ajax({
                            type: 'POST',
                            url: '/api/Karte/KupacDatumKasnije',
                            data: obj2,
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {

                               // alert(data);
                                var jsonObj = JSON.parse(data);
                                for (i = 0; i < jsonObj.length; i++) {
                                    var lista = "<tr>"
                                    lista += "<td>" + jsonObj[i].Nazivmanifestacije + "</td>";
                                    lista += "<td>" + jsonObj[i].Datummanifestacije + "</td>";
                                    lista += " <td>" + jsonObj[i].Cena + "</td>";

                                    if (jsonObj[i].Tipkarte == 0)//vip
                                    {
                                        lista += "<td>" + " VIP " + "</td>";
                                    } else if (jsonObj[i].Tipkarte == 1) {//regular
                                        lista += "<td>" + " REGULAR " + "</td>";
                                    } else {
                                        lista += "<td>" + " FAN PIT " + "</td>";
                                    }

                                    if (jsonObj[i].Status == 0) {
                                        lista += "<td> Rezervisana </td>";
                                        var manifestacija = jsonObj[i].Nazivmanifestacije + ";" + jsonObj[i].Datummanifestacije;
                                        lista += "<td>" + "<button type = \"button\" id=\"" + manifestacija + "\" class=\"use-address\">Komentarisi</button>" + "</td>";
                                    } else {
                                        if (jsonObj[i].MogucOdustanak == 1) {   //moguce je odustati
                                            lista += "<td> Odustanak </td>";
                                            lista += "<td>" + "<button type = \"button\" id=\"" + jsonObj[i].Idkarte + "\" class=\"odustani\">Odustani</button>" + "</td>";
                                        }
                                    }

                                    lista += "</tr>";
                                    $("#tabelaKarte").append(lista);
                                    //lista += "</td>"
                                }

                                //        document.getElementById('lista').innerHTML = lista;

                            },
                            error: function (data) {
                                alert("Greska!");
                            }
                        });
                    });
                    //------------------------------------------
                    $("#datumR").click(function () {
                        //var karte = $("#k_tip option:selected").val();
                        //alert("od" + karte);
                        var obj2 = JSON.stringify({
                            "korisnik": korisnik.Korisnickoime
                        });

                        var tabelica = document.getElementById('tabelaKarte');
                        for (var i = 1; i < tabelica.rows.length;) {
                            tabelica.deleteRow(i);
                        }

                        $.ajax({
                            type: 'POST',
                            url: '/api/Karte/KupacDatumRanije',
                            data: obj2,
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {

                                //alert(data);
                                var jsonObj = JSON.parse(data);
                                for (i = 0; i < jsonObj.length; i++) {
                                    var lista = "<tr>"
                                    lista += "<td>" + jsonObj[i].Nazivmanifestacije + "</td>";
                                    lista += "<td>" + jsonObj[i].Datummanifestacije + "</td>";
                                    lista += " <td>" + jsonObj[i].Cena + "</td>";

                                    if (jsonObj[i].Tipkarte == 0)//vip
                                    {
                                        lista += "<td>" + " VIP " + "</td>";
                                    } else if (jsonObj[i].Tipkarte == 1) {//regular
                                        lista += "<td>" + " REGULAR " + "</td>";
                                    } else {
                                        lista += "<td>" + " FAN PIT " + "</td>";
                                    }

                                    if (jsonObj[i].Status == 0) {
                                        lista += "<td> Rezervisana </td>";
                                        var manifestacija = jsonObj[i].Nazivmanifestacije + ";" + jsonObj[i].Datummanifestacije;
                                        lista += "<td>" + "<button type = \"button\" id=\"" + manifestacija + "\" class=\"use-address\">Komentarisi</button>" + "</td>";
                                    } else {
                                        if (jsonObj[i].MogucOdustanak == 1) {   //moguce je odustati
                                            lista += "<td> Odustanak </td>";
                                            lista += "<td>" + "<button type = \"button\" id=\"" + jsonObj[i].Idkarte + "\" class=\"odustani\">Odustani</button>" + "</td>";
                                        }
                                    }

                                    lista += "</tr>";
                                    $("#tabelaKarte").append(lista);
                                    //lista += "</td>"
                                }

                                //        document.getElementById('lista').innerHTML = lista;

                            },
                            error: function (data) {
                                alert("Greska!");
                            }
                        });
                    });
                    //------------------------------------------
                    $("#cenaR").click(function () {
                        //var karte = $("#k_tip option:selected").val();
                        //alert("od" + karte);
                        var obj2 = JSON.stringify({
                            "korisnik": korisnik.Korisnickoime
                        });

                        var tabelica = document.getElementById('tabelaKarte');
                        for (var i = 1; i < tabelica.rows.length;) {
                            tabelica.deleteRow(i);
                        }

                        $.ajax({
                            type: 'POST',
                            url: '/api/Karte/KupacCenaRastuce',
                            data: obj2,
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {

                                //alert(data);
                                var jsonObj = JSON.parse(data);
                                for (i = 0; i < jsonObj.length; i++) {
                                    var lista = "<tr>"
                                    lista += "<td>" + jsonObj[i].Nazivmanifestacije + "</td>";
                                    lista += "<td>" + jsonObj[i].Datummanifestacije + "</td>";
                                    lista += " <td>" + jsonObj[i].Cena + "</td>";

                                    if (jsonObj[i].Tipkarte == 0)//vip
                                    {
                                        lista += "<td>" + " VIP " + "</td>";
                                    } else if (jsonObj[i].Tipkarte == 1) {//regular
                                        lista += "<td>" + " REGULAR " + "</td>";
                                    } else {
                                        lista += "<td>" + " FAN PIT " + "</td>";
                                    }

                                    if (jsonObj[i].Status == 0) {
                                        lista += "<td> Rezervisana </td>";
                                        var manifestacija = jsonObj[i].Nazivmanifestacije + ";" + jsonObj[i].Datummanifestacije;
                                        lista += "<td>" + "<button type = \"button\" id=\"" + manifestacija + "\" class=\"use-address\">Komentarisi</button>" + "</td>";
                                    } else {
                                        if (jsonObj[i].MogucOdustanak == 1) {   //moguce je odustati
                                            lista += "<td> Odustanak </td>";
                                            lista += "<td>" + "<button type = \"button\" id=\"" + jsonObj[i].Idkarte + "\" class=\"odustani\">Odustani</button>" + "</td>";
                                        }
                                    }

                                    lista += "</tr>";
                                    $("#tabelaKarte").append(lista);
                                    //lista += "</td>"
                                }

                                //        document.getElementById('lista').innerHTML = lista;

                            },
                            error: function (data) {
                                alert("Greska!");
                            }
                        });
                    });
                    //------------------------------------------

                    $("#cenaO").click(function () {
                        //var karte = $("#k_tip option:selected").val();
                        //alert("od" + karte);
                        var obj2 = JSON.stringify({
                            "korisnik": korisnik.Korisnickoime
                        });

                        var tabelica = document.getElementById('tabelaKarte');
                        for (var i = 1; i < tabelica.rows.length;) {
                            tabelica.deleteRow(i);
                        }

                        $.ajax({
                            type: 'POST',
                            url: '/api/Karte/KupacCenaOpadajuce',
                            data: obj2,
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {

                                //alert(data);
                                var jsonObj = JSON.parse(data);
                                for (i = 0; i < jsonObj.length; i++) {
                                    var lista = "<tr>"
                                    lista += "<td>" + jsonObj[i].Nazivmanifestacije + "</td>";
                                    lista += "<td>" + jsonObj[i].Datummanifestacije + "</td>";
                                    lista += " <td>" + jsonObj[i].Cena + "</td>";

                                    if (jsonObj[i].Tipkarte == 0)//vip
                                    {
                                        lista += "<td>" + " VIP " + "</td>";
                                    } else if (jsonObj[i].Tipkarte == 1) {//regular
                                        lista += "<td>" + " REGULAR " + "</td>";
                                    } else {
                                        lista += "<td>" + " FAN PIT " + "</td>";
                                    }

                                    if (jsonObj[i].Status == 0) {
                                        lista += "<td> Rezervisana </td>";
                                        var manifestacija = jsonObj[i].Nazivmanifestacije + ";" + jsonObj[i].Datummanifestacije;
                                        lista += "<td>" + "<button type = \"button\" id=\"" + manifestacija + "\" class=\"use-address\">Komentarisi</button>" + "</td>";
                                    } else {
                                        if (jsonObj[i].MogucOdustanak == 1) {   //moguce je odustati
                                            lista += "<td> Odustanak </td>";
                                            lista += "<td>" + "<button type = \"button\" id=\"" + jsonObj[i].Idkarte + "\" class=\"odustani\">Odustani</button>" + "</td>";
                                        }
                                    }

                                    lista += "</tr>";
                                    $("#tabelaKarte").append(lista);
                                    //lista += "</td>"
                                }

                                //        document.getElementById('lista').innerHTML = lista;

                            },
                            error: function (data) {
                                alert("Greska!");
                            }
                        });
                    });
                    //------------------------------------------

                    $("#nazivZA").click(function () {
                        //var karte = $("#k_tip option:selected").val();
                        //alert("od" + karte);
                        var obj2 = JSON.stringify({
                            "korisnik": korisnik.Korisnickoime
                        });

                        var tabelica = document.getElementById('tabelaKarte');
                        for (var i = 1; i < tabelica.rows.length;) {
                            tabelica.deleteRow(i);
                        }

                        $.ajax({
                            type: 'POST',
                            url: '/api/Karte/KupacNazivZA',
                            data: obj2,
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {

                                //alert(data);
                                var jsonObj = JSON.parse(data);
                                for (i = 0; i < jsonObj.length; i++) {
                                    var lista = "<tr>"
                                    lista += "<td>" + jsonObj[i].Nazivmanifestacije + "</td>";
                                    lista += "<td>" + jsonObj[i].Datummanifestacije + "</td>";
                                    lista += " <td>" + jsonObj[i].Cena + "</td>";

                                    if (jsonObj[i].Tipkarte == 0)//vip
                                    {
                                        lista += "<td>" + " VIP " + "</td>";
                                    } else if (jsonObj[i].Tipkarte == 1) {//regular
                                        lista += "<td>" + " REGULAR " + "</td>";
                                    } else {
                                        lista += "<td>" + " FAN PIT " + "</td>";
                                    }

                                    if (jsonObj[i].Status == 0) {
                                        lista += "<td> Rezervisana </td>";
                                        var manifestacija = jsonObj[i].Nazivmanifestacije + ";" + jsonObj[i].Datummanifestacije;
                                        lista += "<td>" + "<button type = \"button\" id=\"" + manifestacija + "\" class=\"use-address\">Komentarisi</button>" + "</td>";
                                    } else {
                                        if (jsonObj[i].MogucOdustanak == 1) {   //moguce je odustati
                                            lista += "<td> Odustanak </td>";
                                            lista += "<td>" + "<button type = \"button\" id=\"" + jsonObj[i].Idkarte + "\" class=\"odustani\">Odustani</button>" + "</td>";
                                        }
                                    }

                                    lista += "</tr>";
                                    $("#tabelaKarte").append(lista);
                                    //lista += "</td>"
                                }

                                //        document.getElementById('lista').innerHTML = lista;

                            },
                            error: function (data) {
                                alert("Greska!");
                            }
                        });
                    });
                    //------------------------------------------
                    $("#nazivAZ").click(function () {
                        //var karte = $("#k_tip option:selected").val();
                        //alert("od" + karte);
                        var obj2 = JSON.stringify({
                            "korisnik": korisnik.Korisnickoime
                        });

                        var tabelica = document.getElementById('tabelaKarte');
                        for (var i = 1; i < tabelica.rows.length;) {
                            tabelica.deleteRow(i);
                        }

                        $.ajax({
                            type: 'POST',
                            url: '/api/Karte/KupacNazivAZ',
                            data: obj2,
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {

                                //alert(data);
                                var jsonObj = JSON.parse(data);
                                for (i = 0; i < jsonObj.length; i++) {
                                    var lista = "<tr>"
                                    lista += "<td>" + jsonObj[i].Nazivmanifestacije + "</td>";
                                    lista += "<td>" + jsonObj[i].Datummanifestacije + "</td>";
                                    lista += " <td>" + jsonObj[i].Cena + "</td>";

                                    if (jsonObj[i].Tipkarte == 0)//vip
                                    {
                                        lista += "<td>" + " VIP " + "</td>";
                                    } else if (jsonObj[i].Tipkarte == 1) {//regular
                                        lista += "<td>" + " REGULAR " + "</td>";
                                    } else {
                                        lista += "<td>" + " FAN PIT " + "</td>";
                                    }

                                    if (jsonObj[i].Status == 0) {
                                        lista += "<td> Rezervisana </td>";
                                        var manifestacija = jsonObj[i].Nazivmanifestacije + ";" + jsonObj[i].Datummanifestacije;
                                        lista += "<td>" + "<button type = \"button\" id=\"" + manifestacija + "\" class=\"use-address\">Komentarisi</button>" + "</td>";
                                    } else {
                                        if (jsonObj[i].MogucOdustanak == 1) {   //moguce je odustati
                                            lista += "<td> Odustanak </td>";
                                            lista += "<td>" + "<button type = \"button\" id=\"" + jsonObj[i].Idkarte + "\" class=\"odustani\">Odustani</button>" + "</td>";
                                        }
                                    }

                                    lista += "</tr>";
                                    $("#tabelaKarte").append(lista);
                                    //lista += "</td>"
                                }

                                //        document.getElementById('lista').innerHTML = lista;

                            },
                            error: function (data) {
                                alert("Greska!");
                            }
                        });
                    });
                    //------------------------------------------
                    $("#karta_filter_tip").click(function () {
                        var karte = $("#k_tip option:selected").val();
                       // alert("od" + karte);
                        var obj2 = JSON.stringify({
                            "filter": karte,
                            "korisnik": korisnik.Korisnickoime
                        });

                        var tabelica = document.getElementById('tabelaKarte');
                        for (var i = 1; i < tabelica.rows.length;) {
                            tabelica.deleteRow(i);
                        }

                        $.ajax({
                            type: 'POST',
                            url: '/api/Karte/KupacFilterTip',
                            data: obj2,
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {

                                //alert(data);
                                var jsonObj = JSON.parse(data);
                                for (i = 0; i < jsonObj.length; i++) {
                                    var lista = "<tr>"
                                    lista += "<td>" + jsonObj[i].Nazivmanifestacije + "</td>";
                                    lista += "<td>" + jsonObj[i].Datummanifestacije + "</td>";
                                    lista += " <td>" + jsonObj[i].Cena + "</td>";

                                    if (jsonObj[i].Tipkarte == 0)//vip
                                    {
                                        lista += "<td>" + " VIP " + "</td>";
                                    } else if (jsonObj[i].Tipkarte == 1) {//regular
                                        lista += "<td>" + " REGULAR " + "</td>";
                                    } else {
                                        lista += "<td>" + " FAN PIT " + "</td>";
                                    }

                                    if (jsonObj[i].Status == 0) {
                                        lista += "<td> Rezervisana </td>";
                                        var manifestacija = jsonObj[i].Nazivmanifestacije + ";" + jsonObj[i].Datummanifestacije;
                                        lista += "<td>" + "<button type = \"button\" id=\"" + manifestacija + "\" class=\"use-address\">Komentarisi</button>" + "</td>";
                                    } else {
                                        if (jsonObj[i].MogucOdustanak == 1) {   //moguce je odustati
                                            lista += "<td> Odustanak </td>";
                                            lista += "<td>" + "<button type = \"button\" id=\"" + jsonObj[i].Idkarte + "\" class=\"odustani\">Odustani</button>" + "</td>";
                                        }
                                    }

                                    lista += "</tr>";
                                    $("#tabelaKarte").append(lista);
                                    //lista += "</td>"
                                }

                                //        document.getElementById('lista').innerHTML = lista;

                            },
                            error: function (data) {
                                alert("Greska!");
                            }
                        });
                    });
                    //--------------------------------------------------------
                    $("#karta_filter").click(function () {
                        var karte = $("#k_status option:selected").val();
                        //alert("od" + karte);
                        var obj2 = JSON.stringify({
                            "filter": karte,
                            "korisnik": korisnik.Korisnickoime
                        });

                        var tabelica = document.getElementById('tabelaKarte');
                        for (var i = 1; i < tabelica.rows.length;) {
                            tabelica.deleteRow(i);
                        }

                        $.ajax({
                            type: 'POST',
                            url: '/api/Karte/KartePrikazKupac',
                            data: obj2,
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            success: function (data) {

                                //alert(data);
                                var jsonObj = JSON.parse(data);
                                for (i = 0; i < jsonObj.length; i++)
                                {
                                    var lista="<tr>"
                                    lista += "<td>" + jsonObj[i].Nazivmanifestacije + "</td>";
                                    lista += "<td>" + jsonObj[i].Datummanifestacije + "</td>";
                                    lista += " <td>" + jsonObj[i].Cena + "</td>";

                                    if (jsonObj[i].Tipkarte == 0)//vip
                                    {
                                        lista += "<td>" + " VIP " + "</td>";
                                    } else if (jsonObj[i].Tipkarte == 1)
                                    {//regular
                                        lista += "<td>" + " REGULAR " + "</td>";
                                    } else
                                    {
                                        lista += "<td>"+" FAN PIT " + "</td>";
                                    }

                                    if (jsonObj[i].Status == 0) {
                                        lista += "<td> Rezervisana </td>";
                                        var manifestacija = jsonObj[i].Nazivmanifestacije + ";" + jsonObj[i].Datummanifestacije;
                                        lista += "<td>" + "<button type = \"button\" id=\"" + manifestacija + "\" class=\"use-address\">Komentarisi</button>" + "</td>";
                                    } else {
                                        if (jsonObj[i].MogucOdustanak == 1) {   //moguce je odustati
                                            lista += "<td> Odustanak </td>";
                                            lista += "<td>" + "<button type = \"button\" id=\"" + jsonObj[i].Idkarte + "\" class=\"odustani\">Odustani</button>" + "</td>";
                                        }
                                    }

                                    lista += "</tr>";
                                    $("#tabelaKarte").append(lista);
                                    //lista += "</td>"
                                }
                                
                        //        document.getElementById('lista').innerHTML = lista;

                            },
                            error: function (data) {
                                alert("Greska!");
                            }
                        });
                    });
                }

                $(document).on('click', '.odustani', function () {     //klikom na dugme Rezervisi(class .korpa) prikazace se koliko je karapa odabrano i cena
                    //odbija rezervaciju
                    var polje = this.id;
                    var karte = $("#k_status option:selected").val();
                    var obj = JSON.stringify({
                        "idkarte": polje,
                        "filter": karte,
                        "korisnik": korisnik.Korisnickoime
                    });

                    var tabelica = document.getElementById('tabelaKarte');
                    for (var i = 1; i < tabelica.rows.length;) {
                        tabelica.deleteRow(i);
                    }

                    $.ajax({
                        type: 'POST',
                        url: '/api/Karte/ObrisiKartu',
                        data: obj,
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        success: function (data) {

                            var jsonObj = JSON.parse(data);
                           // alert(jsonObj);
                            
                            for (i = 0; i < jsonObj.length; i++) {
                                var lista = "<tr>"
                                lista += "<td>" + jsonObj[i].Nazivmanifestacije + "</td>";
                                lista += "<td>" + jsonObj[i].Datummanifestacije + "</td>";
                                lista += " <td>" + jsonObj[i].Cena + "</td>";

                                if (jsonObj[i].Tipkarte == 0)//vip
                                {
                                    lista += "<td>" + " VIP " + "</td>";
                                } else if (jsonObj[i].Tipkarte == 1) {//regular
                                    lista += "<td>" + " REGULAR " + "</td>";
                                } else {
                                    lista += "<td>" + " FAN PIT " + "</td>";
                                }

                                if (jsonObj[i].Status == 0) {
                                    lista += "<td> Rezervisana </td>";
                                    var manifestacija = jsonObj[i].Nazivmanifestacije + ";" + jsonObj[i].Datummanifestacije;
                                    lista += "<td>" + "<button type = \"button\" id=\"" + manifestacija + "\" class=\"use-address\">Komentarisi</button>" + "</td>";
                                } else {
                                    if (jsonObj[i].MogucOdustanak == 1) {   //moguce je odustati
                                        lista += "<td> Odustanak </td>";
                                        lista += "<td>" + "<button type = \"button\" id=\"" + jsonObj[i].Idkarte + "\" class=\"odustani\">Odustani</button>" + "</td>";
                                    }
                                }

                                lista += "</tr>";
                                $("#tabelaKarte").append(lista);
                            }
                            //lista += "</ul>";
                            //document.getElementById('lista').innerHTML = lista;

                        },
                        error: function (data) {
                            alert("Greska!");
                        }
                    });

                });

                var kojaMANIFESTACIJA;
                $(document).on('click', '.use-address', function () {
                    alert("komensar");
                    kojaMANIFESTACIJA = this.id;
                    var span = document.getElementsByClassName("close")[0];
                    var modal = document.getElementById("myModal");
                    // When the user clicks on the button, open the modal
                   // btn.onclick = function() {
                      modal.style.display = "block";
                    //}

                    // When the user clicks on <span> (x), close the modal
                    span.onclick = function() {
                      modal.style.display = "none";
                    }

                    // When the user clicks anywhere outside of the modal, close it
                    window.onclick = function(event) {
                      if (event.target == modal) {
                        modal.style.display = "none";
                      }
                    }
                });
                //------------prosledjivanje komenatra i ocena
                $("#unetComm").click(function () {
                    var ocena = $("#k_ocena option:selected").val();
                    var kom = $("#comments").val();
                    
                    //alert("kom: " + kom + "\nocena: " + ocena + " koja mani: " + kojaMANIFESTACIJA);
                    
                    var obj2 = JSON.stringify({
                        "ocena": ocena,
                        "korisnik": korisnik.Korisnickoime,
                        "comm": kom,
                        "mani": kojaMANIFESTACIJA
                    });
                    $.ajax({
                        type: 'POST',
                        url: '/api/Karte/KomentarOcena',
                        data: obj2,
                        contentType: 'application/json; charset=utf-8',
                        dataType: 'json',
                        success: function (data) {

                            //console.log(data);
                            var jsonObj = JSON.parse(data);
                            alert(jsonObj);
                            if (jsonObj == "Uspesno zabelezeno.") {
                                var modal = document.getElementById("myModal");
                                modal.style.display = "none";
                                $('#k_ocena option:selected').remove();
                                $('textarea#comments').val("");
                            } else {
                                $('textarea#comments').val("");
                            }
                        },
                        error: function (data) {
                            alert("Greska!");
                        }
                    });
                });
                //-------------------

                $('#podaci').show();
                document.getElementById('korisnickoime').value = korisnik.Korisnickoime;
                document.getElementById('lozinka').value = korisnik.Lozinka;
                document.getElementById('ime').value = korisnik.Ime;
                document.getElementById('prezime').value = korisnik.Prezime;
                document.getElementById('datumrodjenja').value = korisnik.Datumrodjenja;
                var kojipol;
                if (korisnik.Pol==0) {
                    kojipol = "Muski";
                } else {
                    kojipol = "Zenski";
                }
                document.getElementById('polovi').value = kojipol;//dodato
                //---------------------------------------------------------------------------------------
                $("#btnReg").click(function () {
                    var uloga;
                    if (korisnik.Uloga == 0) { uloga = "Administrator"; } else if (korisnik.Uloga == 1) { uloga = "Prodavac"; } else { uloga = "Kupac"; }
                    var tip ;
                    if (korisnik.Tip == 0) { tip = "Zlatni"; } else if (korisnik.Tip == 1) { tip = "Srebrni"; } else if (korisnik.Tip == 2) { tip = "Bronzani"; } else { tip = "Nepoznat"; }
                    var bodovi = korisnik.Sakupljenibodovi;
                    var obr = korisnik.Obrisan;
                    console.log("uloga" + uloga + " tip" + tip + " bodovi" + bodovi);

                    let k1 = document.getElementById("korisnickoime");
                    let k2 = document.getElementById("lozinka");
                    let k3 = document.getElementById("ime");
                    let k4 = document.getElementById("prezime");
                    let k5 = document.getElementById("datumrodjenja");

                    if (!k1.checkValidity() || !k2.checkValidity() || !k3.checkValidity() || !k4.checkValidity() || !k5.checkValidity()) {
                        alert("Molimo popunite sva polja na ispravan način.");
                    } else {
                        //var uloga = korisnik.Uloga;
                        //var bodovi = korisnik.Sakupljenibodovi;
                        //var tip = korisnik.Tip;
                        //var obr = korisnik.Obrisan;
                        //alert("uloga"+uloga+" tip"+tip);
                        var korisnickoime = $("#korisnickoime").val();
                        var lozinka = $("#lozinka").val();
                        var ime = $("#ime").val();
                        var prezime = $("#prezime").val();
                        var pol = $("#polovi option:selected").val();//$("#pol").val();
                        var datumrodjenja = $("#datumrodjenja").val();
                        var obj = JSON.stringify({
                            "korisnickoime": korisnickoime,
                            "lozinka": lozinka,
                            "ime": ime,
                            "prezime": prezime,
                            "pol": pol,
                            "datumrodjenja": datumrodjenja,
                            "uloga": uloga,
                            "sakupljenibodovi": bodovi,
                            "tip": tip,
                            "obrisan": obr
                        });

                        $.ajax({
                            type: 'PUT',
                            url: '/api/Autentifikacija',
                            data: obj,
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            //    success: function (data) {
                            //        if (data == 1) {
                            //            alert('Uspesno ste izmenili podatke.');

                            //        } else if (data == 0) {
                            //            alert('Niste uneli ispravan datum rodjenja.');
                            //        }
                            //    }
                            //});
                        }).done(function (data) {
                            if (data != null) {
                                console.log('SUCCESS');
                                sessionStorage.removeItem('logovan');
                                sessionStorage.setItem('logovan', JSON.stringify(data));
                                console.log(JSON.stringify(data));
                            } else {
                                alert("Niste uneli ispravne podatke");//treba refresh sranice uraditi!!!---DOPUNI
                            }
                            window.location.reload(true);
                            //alert("osvezilo");
                        }).fail(function (msg) {
                            console.log('FAIL');
                        });
                    }
                });
            }

        });
    </script>
    
    <style>
        ::-webkit-input-placeholder { /* Chrome, Firefox, Opera, Safari 10.1+ */
            color: grey;
            opacity: 1; /* Firefox */
        }
        .topnav {
            background-color: #333;
            overflow: hidden;
            border-radius: 15px;
        }

            /* Style the links inside the navigation bar */
            .topnav a {
                float: left;
                color: #f2f2f2;
                text-align: center;
                padding: 14px 16px;
                text-decoration: none;
                font-size: 17px;
                color: #ffffff;
            }

                /* Change the color of links on hover */
                .topnav a:hover {
                    background-color: #ddd;
                    color: black;
                }

                /* Add a color to the active/current link */
                .topnav a.active {
                    background-color: #4CAF50;
                    color: #ffffff;
                }

        html, table {
            /*overflow: scroll;*/
            overflow-y: scroll;
        }

        .header-img {
            height: 3%;
            width: 4%;
        }
        #DIVreg {
            /*position: absolute;*/
            float: left;
            position: relative;
            top: 65%;
            /*left: 50%;*/
            /*transform: translate(-50%,-50%);*/
            /*position: absolute;*/
            width: 410px;
            height: 700px;
            box-sizing: border-box;
            background: rgba(51, 51, 51, 1);
            /*background: rgba(51, 51, 51, 0.7);*/
            padding: 40px;
            margin-top: 20px;
        }

            #DIVreg input, select {
                margin-bottom: 20px;
                width: 100%;
            }

            #DIVreg select {
                margin-top: 20px;
                padding: 10px 0;
            }

            #DIVreg input[type=text], #DIVreg input[type=password] {
                border: none;
                border-bottom: 1px solid #ffffff;
                background-color: transparent;
                outline: none;
                height: 40px;
                color: #ffffff;
            }

       #DIVreg ::-webkit-input-placeholder {
            color: #ffffff;
        }
        #tekst {
            color: #ffffff;
        }
        #DIVreg input[type=submit] {
            border: none;
            height: 40px;
            outline: none;
            color: #ffffff;
            font-size: 15px;
            background-color: tomato;
            cursor: pointer;
            border-radius: 20px;
        }

            #DIVreg input[type=submit]:hover {
                background-color: cyan;
                color: #ffffff;
            }

            #DIVreg input[type=submit]:disabled {
                background-color: gray;
                color: #ffffff;
                cursor: not-allowed;
            }
            /*za prevlacenje*/
        #mydiv {
            position: absolute;
            float:left;
            z-index: 9;
            background-color: #f1f1f1;
            border: 1px solid #d3d3d3;
            text-align: center;
        }

        #mydivheader {
            padding: 10px;
            cursor: move;
            z-index: 10;
            background-color: #2196F3;
            color: #fff;
        }
        /*za komentare*/
        .container {
            border: 2px solid #ccc;
            background-color: #eee;
            border-radius: 5px;
            padding: 16px;
            margin: 16px 0;
        }

            /* Clear floats after containers */
            .container::after {
                content: "";
                clear: both;
                display: table;
            }

            /* Float images inside the container to the left. Add a right margin, and style the image as a circle */
            .container img {
                float: left;
                margin-right: 20px;
                border-radius: 50%;
            }

            /* Increase the font-size of a span element */
            .container span {
                font-size: 20px;
                margin-right: 15px;
            }

        /* Add media queries for responsiveness. This will center both the text and the image inside the container */
        @media (max-width: 500px) {
            .container {
                text-align: center;
            }

                .container img {
                    margin: auto;
                    float: none;
                    display: block;
                }
        }

        button {
            border: none;
            height: 40px;
            outline: none;
            color: #ffffff;
            font-size: 15px;
            background-color: #333;
            color: #ffffff;
            cursor: pointer;
            border-radius: 20px;
        }

            button:hover {
                background-color: #4CAF50;
                color: #ffffff;
            }

       #tabelaKarte table {
            z-index: 2;
            /*left:50%;
            top:50%;
            transform:translate(-50%,-50%);
            width:60%;*/
            border-collapse: collapse;
            border-spacing: 0;
            border-radius: 12px 12px 0 0;
            overflow: hidden;
            background: #fafafa;
            text-align: center;
        }
        /*tr {
            border: 2px solid #333;
            border-radius: 15px;
        }*/

        #tabelaKarte th, td {
            padding: 10px 15px;
        }

        #tabelaKarte th {
            /*background: #ba68c8;*/
            background-color: #333;
            color: #fafafa;
            text-transform: uppercase;
        }

        #tabelaKarte tr:nth-child(odd) {
            background: #eeeeee;
        }

        #tabelaKarte  html, table {
            /*overflow: scroll;*/
            overflow-y: scroll;
        }

        /*iskacuci prozor*/
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

        /* Modal Content/Box */
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto; /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 30%; /* Could be more or less, depending on screen size */
        }

        /* The Close Button */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

            .close:hover,
            .close:focus {
                color: black;
                text-decoration: none;
                cursor: pointer;
            }
            /*modal dugme za komentar*/
         input[type=submit] {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 16px 32px;
            text-decoration: none;
            margin: 4px 2px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1 style="text-align:center;font-size: 40px ;color:#333"><img class="header-img" src="slike/odlican.png" alt="logo" />Karte</h1>

    <div id="stranica">
        <div class="topnav">
            <a href="pocetna.html">Pocetna</a>
            <a href="login.html">Prijava</a>
            <a href="Register.html">Registracija</a>
            <a href="logout.html">Odjava</a>
            <div id="podaci">
                <a class="active" href="detaljiProfil.html">Moji podaci</a>
            </div>

        </div>
    </div>

    <div id="DIVreg">
        <h2 style="color:#ffffff; font-weight:bold; font-family:Arial;text-align-last: center;">Osnovni podaci</h2>
        <!--<form action="" method="post">-->
        <table class="table">
            <tr>
                <td id="tekst">Korisnicko ime:</td>
                <td>
                    <input type="text" id="korisnickoime" name="korisnickoime" placeholder="od 3 karakera min" pattern="[0-9a-zA-Z]{3,}" disabled />
                </td>

            </tr>

            <tr>
                <td id="tekst">Lozinka:</td>
                <td>
                    <input type="text" id="lozinka" name="lozinka" placeholder="od 4 karaktera min" pattern="[0-9a-zA-Z]{4,}" required />
                </td>

            </tr>

            <tr>
                <td id="tekst">Ime:</td>
                <td>
                    <input type="text" id="ime" name="ime" placeholder="od 3 karaktera min" pattern="[a-zA-Z]{3,}" required />
                </td>

            </tr>

            <tr>
                <td id="tekst">Prezime:</td>
                <td>
                    <input type="text" id="prezime" name="prezime" placeholder="od 3 karaktera min" pattern="[a-zA-Z]{3,}" required />
                </td>

            </tr>

            <tr>
                <td id="tekst"><label for="pol">Pol:</label></td>
                <td>
                    <select name="pol" id="polovi">
                        <option id="polovi" value="Zenski">Zenski</option>
                        <option id="polovi" value="Muski">Muski</option>
                    </select>
                </td>
            </tr>

            <tr>
                <td id="tekst">Datum rodjenja:</td>
                <td>
                    <input type="text" id="datumrodjenja" name="datumrodjenja" placeholder="DD-MM-YYYY" required pattern="\d{2}-\d{2}-\d{4}" />
                </td>

            </tr>

            <tr>

                <td colspan="2">
                    <input id="btnReg" type="submit" value="Izmeni" />
                </td>
            </tr>
        </table>

        <!--</form>-->
    </div>


    <!--<div style="float:left;" id="lista"></div>-->
    <div style=" display: inline-block;" id="korisnikKarte">
        <h2 style="text-align:center">Karte</h2>


        <select id="k_status" style="width: 150px;">
            <option value="Sve">Sve karte</option>
            <option value="Rezervisana">Rezervisano</option>
            <option value="Odustanak">Predstojece</option>
        </select>
        <button type="button" id="karta_filter">Filtriraj po statusu karte</button>
        <select id="k_tip" style="width: 150px;">
            <option value="Sve">Sve karte</option>
            <option value="Regular">Regular</option>
            <option value="Vip">Vip</option>
            <option value="Fanpit">Fan pit</option>
        </select>
        <button type="button" id="karta_filter_tip">Filtriraj po tipu karte</button><br>
        <button type="button" id="nazivAZ">Naziv A-Z</button>
        <button type="button" id="nazivZA">Naziv Z-A</button>
        <button type="button" id="cenaO">Cena opadajuce</button>
        <button type="button" id="cenaR">Cena rastuce</button>
        <button type="button" id="datumR">Datum raniji</button>
        <button type="button" id="datumK">Datum kasniji</button><br>

        <input type="text" id="find_naziv" placeholder="naziv manifestacije" pattern="^[0-9a-zA-Z]+( [0-9a-zA-Z]+)*$" />
        <input type="text" id="find_datumOD" placeholder="od datum dd-mm-yyyy" pattern="^([0-2][0-9]|(3)[0-1])-(((0)[0-9])|((1)[0-2]))-\d{4}$" />
        <input type="text" id="find_datumDO" placeholder="do datum dd-mm-yyyy" pattern="^([0-2][0-9]|(3)[0-1])-(((0)[0-9])|((1)[0-2]))-\d{4}$" />
        <input type="number" min="0" id="find_cenaOD" placeholder="cena regular od" pattern="[0-9]+" oninput="validity.valid||(value='');" />
        <input type="number" min="0" id="find_cenaDO" placeholder="cena regular do" pattern="[0-9]+" oninput="validity.valid||(value='');" />

        <button type="button" id="pretraga">Pretrazi</button>

        <table id="tabelaKarte">
            <tr>
                <th>Naziv</th>
                <th>Datum</th>
                <th>Cena</th>
                <th>Tip</th>
                <th>Status</th>
                <th>Opcije</th>
            </tr>

        </table>
    </div>


    <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content" style="text-align:center">
            <span class="close">&times;</span>
            <h2>Ostavite komentar i ocenu</h2>

            <select id="k_ocena" style="width: 150px;text-align:center">
                <option value="0" disabled selected>Ocenite</option>
                <option value="0">Bez ocene</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select><br>
            <textarea name="comments" id="comments" maxlength="50"  placeholder="max 50 karaktera" style="font-family:sans-serif;font-size:0.8em;resize:none;height: 10em;"></textarea>
            <br><input type="submit" id="unetComm" value="Prosledi" />
            <p>Hvala Vam na saradnji</p>
        </div>

    </div>



    <!--<script>
        dragElement(document.getElementById("mydiv"));

        function dragElement(elmnt) {
            var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            if (document.getElementById(elmnt.id + "header")) {
                // if present, the header is where you move the DIV from:
                document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown;
            } else {
                // otherwise, move the DIV from anywhere inside the DIV:
                elmnt.onmousedown = dragMouseDown;
            }

            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                // get the mouse cursor position at startup:
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                // call a function whenever the cursor moves:
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                // calculate the new cursor position:
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                // set the element's new position:
                elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
                elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                // stop moving when mouse button is released:
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }</script>-->
</body>
</html>